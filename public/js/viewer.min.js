function updateData(){$("#title-value").text(data.title),$("#description-value").text(data.description);var t=data.ballotBoxes,a=$("#ballot-boxes"),o=null===a.val()?-1:a.val();a.empty(),a.append($("<option>",{id:"bb-option-total",value:-1,text:"Total",selected:!0}));for(var e=0;e<t.length;e++)a.append($("<option>",{id:"bb-option-"+e,value:e,text:t[e].name}));o=Math.min(o,t.length-1),a.val(o),setBallotBoxesVal(o);var l=data.options;$("#options").empty();for(var e=0;e<l.length;e++){name=l[e].name,color=l[e].color;var n=0,s=0;if(-1!=o)n=t[o].options[e],s=t[o].votes;else for(var i=0;i<data.ballotBoxes.length;i++)n+=data.ballotBoxes[i].options[e],s+=data.ballotBoxes[i].votes;percentage=100*n/s,genBBOption(name,color,n,percentage.toFixed(2),e)}updateChart()}function setBallotBoxesVal(t){for(var a=0,o=0,e=0;e<data.ballotBoxes.length;e++)a+=parseInt(data.ballotBoxes[e].votes),o+=parseInt(data.ballotBoxes[e].quorum);if(-1==t){var l=o,n=a;$("#bb-name-value").text("Total"),$("#bb-votes-value").text(a)}else{var s=data.ballotBoxes[t],l=s.quorum,n=s.votes;$("#bb-name-value").text(s.name),$("#bb-votes-value").text(s.votes)}var i=100*n/l;$("#bb-quorum-value").text(""+i.toFixed(2)+"% ("+l+")")}function setOptionsVal(t){for(var a="option-",o=0;o<data.options.length;o++){if(-1==t)for(var e=0,l=0,n=0;n<data.ballotBoxes.length;n++)e+=parseInt(data.ballotBoxes[n].options[o]),l+=parseInt(data.ballotBoxes[n].votes);else var e=data.ballotBoxes[t].options[o],l=data.ballotBoxes[t].votes;var s=100*e/l;$("#"+a+o+"-value").text(e),$("#"+a+o+"-percentage-value").text(s.toFixed(2))}}function genBBOption(t,a,o,e,l){var n=$("#options"),s="option-"+l;n.append($("<tr>",{id:s}).append($("<td>",{type:"text","class":"form-control input-sm",id:s+"-name-value",text:t})).append($("<td>",{type:"text","class":"form-control input-sm",id:s+"-name-value",style:"background-color:"+a})).append($("<td>",{type:"text","class":"form-control input-sm",id:s+"-value",text:o})).append($("<td>",{type:"text","class":"form-control input-sm",id:s+"-percentage-value",text:e})))}function bindSelect(){$("#ballot-boxes").change(selectBallotBoxesAction)}function selectBallotBoxesAction(){var t=$("#ballot-boxes").val();setBallotBoxesVal(t),setOptionsVal(t),updateChart()}function generateChartData(){var t=[],a=$("#ballot-boxes").val();if(-1==a){for(var o={name:"Total",votes:0,quorum:0,options:[]},e=0;e<data.options.length;e++)o.options[e]=0;for(var l=0;l<data.ballotBoxes.length;l++){o.votes+=data.ballotBoxes[l].votes,o.quorum+=data.ballotBoxes[l].quorum;for(var e=0;e<data.options.length;e++)o.options[e]+=data.ballotBoxes[l].options[e]}}else var o=data.ballotBoxes[a];for(var e=0;e<data.options.length;e++)t[e]={value:o.options[e],color:data.options[e].color,highlight:"#BEBEBE",label:data.options[e].name};return t}function updateChart(){null!==myPieChart&&myPieChart.destroy(),chartData=generateChartData(),ctx=$("#myChart").get(0).getContext("2d"),myPieChart=new Chart(ctx).Pie(chartData,{animation:!1,segmentShowStroke:!1})}var data,chartData,ctx,myPieChart=null;socket.on("data",function(t){console.log("Updating new data..."),data=t,updateData()}),socket.on("dataBit",function(t){console.log(t);var a,o=data;for(a=0;a<t.field.length-1;a++)o=o[t.field[a]];if("DELETE"!=t.value){if(console.log("Updating a bit of data..."),o[t.field[a]]=t.value,"options"==t.field[0]&&2==t.field.length)for(var a=0;a<data.ballotBoxes.length;a++){var e=data.ballotBoxes[a].options;e[e.length]=0}}else{var l=t.field[a];if(o.splice(l,1),console.log("data Deleted!"),"options"==t.field[0]&&2==t.field.length)for(var a=0;a<data.ballotBoxes.length;a++)data.ballotBoxes[a].options.splice(l,1);if("ballotBoxes"==t.field[0]){bbID=t.field[1];var n=$("#ballot-boxes"),s=null===n.val()?-1:n.val();s>=0&&bbID<=s&&n.val(s-1)}}updateData()}),$(document).ready(function(){bindSelect()});